<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>completion (batch bound functions)</title>
<link rel="stylesheet" href="../../../../myboostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../../../index.html" title="Chapter&#160;1.&#160;Boost.AFIO 0.1">
<link rel="up" href="../async_file_io_dispatcher_base.html" title="async_file_io_dispatcher_base">
<link rel="prev" href="../async_file_io_dispatcher_base.html" title="async_file_io_dispatcher_base">
<link rel="next" href="completion_2_single_bound_function.html" title="completion (single bound function)">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../async_file_io_dispatcher_base.html"><img src="../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../async_file_io_dispatcher_base.html"><img src="../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../../../index.html"><img src="../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="completion_2_single_bound_function.html"><img src="../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions"></a><a class="link" href="completion_2_batch_bound_functions.html" title="completion (batch bound functions)">completion
          (batch bound functions)</a>
</h5></div></div></div>
<p>
            <a class="indexterm" name="id883351"></a>
Schedule a batch of asynchronous invocations of the specified functions
            when their supplied operations complete.
          </p>
<h6>
<a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.h0"></a>
            <span class="phrase"><a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.synopsis"></a></span><a class="link" href="completion_2_batch_bound_functions.html#afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.synopsis">Synopsis</a>
          </h6>
<pre class="programlisting"><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">async_io_op</span><span class="special">&gt;</span> <span class="identifier">async_file_io_dispatcher_base</span><span class="special">::</span><span class="identifier">completion</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span> <span class="identifier">async_io_op</span> <span class="special">&gt;</span> <span class="special">&amp;</span> <span class="identifier">ops</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span> <span class="identifier">async_op_flags</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">function</span><span class="special">&lt;</span> <span class="identifier">async_file_io_dispatcher_base</span><span class="special">::</span><span class="identifier">completion_t</span> <span class="special">&gt;&gt;&gt;</span> <span class="special">&amp;</span> <span class="identifier">callbacks</span><span class="special">)</span></pre>
<h6>
<a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.h1"></a>
            <span class="phrase"><a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.parameters"></a></span><a class="link" href="completion_2_batch_bound_functions.html#afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.parameters">Parameters</a>
          </h6>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                    <p>
                      Type
                    </p>
                  </th>
<th>
                    <p>
                      Concept
                    </p>
                  </th>
<th>
                    <p>
                      Name
                    </p>
                  </th>
<th>
                    <p>
                      Description
                    </p>
                  </th>
</tr></thead>
<tbody>
<tr>
<td>
                    <p>
                      const std::vector&lt; async_io_op &gt; &amp;
                    </p>
                  </td>
<td>
                  </td>
<td>
                    <p>
                      ops
                    </p>
                  </td>
<td>
                    <p>
                      A batch of precondition op handles.
                    </p>
                  </td>
</tr>
<tr>
<td>
                    <p>
                      const std::vector&lt; std::pair&lt; async_op_flags, std::function&lt;
                      async_file_io_dispatcher_base::completion_t &gt;&gt;&gt; &amp;
                    </p>
                  </td>
<td>
                  </td>
<td>
                    <p>
                      callbacks
                    </p>
                  </td>
<td>
                    <p>
                      A batch of pairs of op flags and bound completion handler functions
                      of type <code class="literal"><code class="computeroutput"><span class="identifier">completion_t</span></code></code>
                    </p>
                  </td>
</tr>
</tbody>
</table></div>
<h6>
<a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.h2"></a>
            <span class="phrase"><a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.returns"></a></span><a class="link" href="completion_2_batch_bound_functions.html#afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.returns">Returns</a>
          </h6>
<p>
            A batch of op handles
          </p>
<h6>
<a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.h3"></a>
            <span class="phrase"><a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.header"></a></span><a class="link" href="completion_2_batch_bound_functions.html#afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.header">Header</a>
          </h6>
<p>
            <code class="computeroutput"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">afio</span><span class="special">/</span><span class="identifier">afio</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code>
          </p>
<h6>
<a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.h4"></a>
            <span class="phrase"><a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.complexity"></a></span><a class="link" href="completion_2_batch_bound_functions.html#afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.complexity">Complexity</a>
          </h6>
<p>
            Amortised O(N) to dispatch. Amortised O(N/threadpool) to complete.
          </p>
<h6>
<a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.h5"></a>
            <span class="phrase"><a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.exception_model"></a></span><a class="link" href="completion_2_batch_bound_functions.html#afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.exception_model">Exception
            Model</a>
          </h6>
<p>
            Propagates exceptions of any input preconditions with an errored state
            at the point of dispatch, and throws a <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">runtime_error</span></code>
            if any inputs have values which could not possibly be correct. Once a
            batch of input ops has been verified at the point of entry as not errored,
            you are guaranteed that the batch is atomically scheduled as a whole,
            unless one of the following conditions occurs: (i) A failure to allocate
            memory occurs.
          </p>
<h6>
<a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.h6"></a>
            <span class="phrase"><a name="afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.example"></a></span><a class="link" href="completion_2_batch_bound_functions.html#afio.reference.classes.async_file_io_dispatcher_base.completion_2_batch_bound_functions.example">Example</a>
          </h6>
<pre class="programlisting"><span class="comment">// Create a dispatcher instance</span>
<span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_file_io_dispatcher_base</span><span class="special">&gt;</span> <span class="identifier">dispatcher</span><span class="special">=</span>
    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">make_async_file_io_dispatcher</span><span class="special">();</span>

<span class="comment">// Completion handlers are the lowest level completion routine available, and therefore the least</span>
<span class="comment">// overhead but at the cost of considerable extra programmer effort. You almost certainly want</span>
<span class="comment">// to use the call() member function instead.</span>

<span class="comment">// First create some callable entity ...</span>
<span class="keyword">auto</span> <span class="identifier">completer</span><span class="special">=[](</span>
    <span class="comment">/* These are always the standard parameters */</span>
    <span class="identifier">size_t</span> <span class="identifier">id</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_io_handle</span><span class="special">&gt;</span> <span class="identifier">h</span><span class="special">,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">exception_ptr</span> <span class="special">*</span><span class="identifier">e</span><span class="special">,</span>
    <span class="comment">/* From now on user defined parameters */</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">text</span><span class="special">)</span>
  <span class="comment">/* This is always the return type */</span>
  <span class="special">-&gt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="keyword">bool</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_io_handle</span><span class="special">&gt;&gt;</span>
<span class="special">{</span>
    <span class="comment">/* id is the unique, non-zero integer id of this op.
       h is a shared pointer to the file handle context returned by the precondition of this op.
       e is a pointer to an exception_ptr. It is ONLY non-null when this completion was
       called as an immediate completion. It MAY point to a valid exception_ptr if
       this immediate completion is being completed because its precondition threw
       an exception.

       If not an immediately completed completion, if you want to test if the precondition
       threw an exception, you'll need to pass in its op's shared state (the h member)
       so you can check the shared_future for an exception state.
    */</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">text</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>

    <span class="comment">// Return whether this completion has completed now or is it deferred,</span>
    <span class="comment">// along with the handle we pass onto any completions completing on this op</span>
    <span class="keyword">return</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_pair</span><span class="special">(</span><span class="keyword">true</span><span class="special">,</span> <span class="identifier">h</span><span class="special">);</span>
<span class="special">};</span>

<span class="comment">// Bind any user defined parameters to create a proper boost::afio::async_file_io_dispatcher_base::completion_t</span>
<span class="identifier">std</span><span class="special">::</span><span class="identifier">function</span><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_file_io_dispatcher_base</span><span class="special">::</span><span class="identifier">completion_t</span><span class="special">&gt;</span> <span class="identifier">boundf</span><span class="special">=</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">bind</span><span class="special">(</span><span class="identifier">completer</span><span class="special">,</span>
        <span class="comment">/* The standard parameters */</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">placeholders</span><span class="special">::</span><span class="identifier">_1</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">placeholders</span><span class="special">::</span><span class="identifier">_2</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">placeholders</span><span class="special">::</span><span class="identifier">_3</span><span class="special">,</span>
        <span class="comment">/* Any values for the user defined parameters. Remember ALWAYS to pass by value! */</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">(</span><span class="string">"Hello world"</span><span class="special">));</span>

<span class="comment">// Schedule an asynchronous call of the completion with some bound set of arguments</span>
<span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_io_op</span> <span class="identifier">helloworld</span><span class="special">=</span>
    <span class="identifier">dispatcher</span><span class="special">-&gt;</span><span class="identifier">completion</span><span class="special">(</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_io_op</span><span class="special">()</span> <span class="comment">/* no precondition */</span><span class="special">,</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_pair</span><span class="special">(</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_op_flags</span><span class="special">::</span><span class="identifier">None</span><span class="special">,</span> <span class="identifier">boundf</span><span class="special">));</span>

<span class="comment">// Create a boost::future&lt;&gt; representing the ops passed to when_all()</span>
<span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">future</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">shared_ptr</span><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">async_io_handle</span><span class="special">&gt;&gt;&gt;</span> <span class="identifier">future</span>
    <span class="special">=</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">afio</span><span class="special">::</span><span class="identifier">when_all</span><span class="special">(</span><span class="identifier">helloworld</span><span class="special">);</span>
<span class="comment">// ... and wait for it to complete</span>
<span class="identifier">future</span><span class="special">.</span><span class="identifier">wait</span><span class="special">();</span>
</pre>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2013 Niall Douglas and Paul Kirth<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../async_file_io_dispatcher_base.html"><img src="../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../async_file_io_dispatcher_base.html"><img src="../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../../../index.html"><img src="../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="completion_2_single_bound_function.html"><img src="../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
