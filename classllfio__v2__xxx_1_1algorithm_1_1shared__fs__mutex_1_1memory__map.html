<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLFIO: llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map&lt; Hasher, HashIndexSize, SpinlockType &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LLFIO<span id="projectnumber">&#160;v2.00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map&lt; Hasher, HashIndexSize, SpinlockType &gt; Class Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Many entity memory mapped shared/exclusive file system based lock.  
 <a href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#details">More...</a></p>

<p><code>#include &quot;memory_map.hpp&quot;</code></p>
<div class="dynheader">
Inheritance diagram for llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map&lt; Hasher, HashIndexSize, SpinlockType &gt;:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.png" usemap="#llfio_5Fv2_5Fxxx::algorithm::shared_5Ffs_5Fmutex::memory_5Fmap_3C_20Hasher_2C_20HashIndexSize_2C_20SpinlockType_20_3E_map" alt=""/>
  <map id="llfio_5Fv2_5Fxxx::algorithm::shared_5Ffs_5Fmutex::memory_5Fmap_3C_20Hasher_2C_20HashIndexSize_2C_20SpinlockType_20_3E_map" name="llfio_5Fv2_5Fxxx::algorithm::shared_5Ffs_5Fmutex::memory_5Fmap_3C_20Hasher_2C_20HashIndexSize_2C_20SpinlockType_20_3E_map">
<area href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html" title="Abstract base class for an object which protects shared filing system resources." alt="llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex" shape="rect" coords="0,0,558,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map_1_1__entity__idx.html">_entity_idx</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a578299b4449875303911db495a9a81ed" id="r_a578299b4449875303911db495a9a81ed"><td class="memItemLeft" align="right" valign="top"><a id="a578299b4449875303911db495a9a81ed" name="a578299b4449875303911db495a9a81ed"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>entity_type</b> = <a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type.html">shared_fs_mutex::entity_type</a></td></tr>
<tr class="memdesc:a578299b4449875303911db495a9a81ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">The type of an entity id. <br /></td></tr>
<tr class="separator:a578299b4449875303911db495a9a81ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2b0ba067395f1d7588e301f07110b8a" id="r_ae2b0ba067395f1d7588e301f07110b8a"><td class="memItemLeft" align="right" valign="top"><a id="ae2b0ba067395f1d7588e301f07110b8a" name="ae2b0ba067395f1d7588e301f07110b8a"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>entities_type</b> = <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#aec91125605e5a8379b7616b7f90d1232">shared_fs_mutex::entities_type</a></td></tr>
<tr class="memdesc:ae2b0ba067395f1d7588e301f07110b8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The type of a sequence of entities. <br /></td></tr>
<tr class="separator:ae2b0ba067395f1d7588e301f07110b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa93c292c86b6447bafd9849ad03cfe78" id="r_aa93c292c86b6447bafd9849ad03cfe78"><td class="memItemLeft" align="right" valign="top"><a id="aa93c292c86b6447bafd9849ad03cfe78" name="aa93c292c86b6447bafd9849ad03cfe78"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>hasher_type</b> = Hasher&lt; <a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type.html#adfb9e2612d4f570f0d3eb043bbb05d81">entity_type::value_type</a> &gt;</td></tr>
<tr class="memdesc:aa93c292c86b6447bafd9849ad03cfe78"><td class="mdescLeft">&#160;</td><td class="mdescRight">The type of the hasher being used. <br /></td></tr>
<tr class="separator:aa93c292c86b6447bafd9849ad03cfe78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae61aba70c59a38a264ae2b643b791a17" id="r_ae61aba70c59a38a264ae2b643b791a17"><td class="memItemLeft" align="right" valign="top"><a id="ae61aba70c59a38a264ae2b643b791a17" name="ae61aba70c59a38a264ae2b643b791a17"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>spinlock_type</b> = SpinlockType</td></tr>
<tr class="memdesc:ae61aba70c59a38a264ae2b643b791a17"><td class="mdescLeft">&#160;</td><td class="mdescRight">The type of the spinlock being used. <br /></td></tr>
<tr class="separator:ae61aba70c59a38a264ae2b643b791a17"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a60b0c32576780e9588b6b58770bc849d" id="r_a60b0c32576780e9588b6b58770bc849d"><td class="memItemLeft" align="right" valign="top"><a id="a60b0c32576780e9588b6b58770bc849d" name="a60b0c32576780e9588b6b58770bc849d"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>memory_map</b> (const <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &amp;)=delete</td></tr>
<tr class="memdesc:a60b0c32576780e9588b6b58770bc849d"><td class="mdescLeft">&#160;</td><td class="mdescRight">No copy construction. <br /></td></tr>
<tr class="separator:a60b0c32576780e9588b6b58770bc849d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32339f45fcf86cbaeceb0f8c6c369337" id="r_a32339f45fcf86cbaeceb0f8c6c369337"><td class="memItemLeft" align="right" valign="top"><a id="a32339f45fcf86cbaeceb0f8c6c369337" name="a32339f45fcf86cbaeceb0f8c6c369337"></a>
<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (const <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &amp;)=delete</td></tr>
<tr class="memdesc:a32339f45fcf86cbaeceb0f8c6c369337"><td class="mdescLeft">&#160;</td><td class="mdescRight">No copy assignment. <br /></td></tr>
<tr class="separator:a32339f45fcf86cbaeceb0f8c6c369337"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70d275a5256eec64030bfffa87acdb87" id="r_a70d275a5256eec64030bfffa87acdb87"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a70d275a5256eec64030bfffa87acdb87">memory_map</a> (<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &amp;&amp;o) noexcept</td></tr>
<tr class="memdesc:a70d275a5256eec64030bfffa87acdb87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move constructor.  <br /></td></tr>
<tr class="separator:a70d275a5256eec64030bfffa87acdb87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcd21bb3b7c8c93dc9b19e3d3f9e0572" id="r_adcd21bb3b7c8c93dc9b19e3d3f9e0572"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#adcd21bb3b7c8c93dc9b19e3d3f9e0572">operator=</a> (<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &amp;&amp;o) noexcept</td></tr>
<tr class="memdesc:adcd21bb3b7c8c93dc9b19e3d3f9e0572"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move assign.  <br /></td></tr>
<tr class="separator:adcd21bb3b7c8c93dc9b19e3d3f9e0572"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac239630e7441631344f828be5fd19360" id="r_ac239630e7441631344f828be5fd19360"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classllfio__v2__xxx_1_1file__handle.html">file_handle</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#ac239630e7441631344f828be5fd19360">handle</a> () const noexcept</td></tr>
<tr class="memdesc:ac239630e7441631344f828be5fd19360"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the handle to file being used for this lock.  <br /></td></tr>
<tr class="separator:ac239630e7441631344f828be5fd19360"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f7f9ad579b9fb0d3700fd31472fb95a" id="r_a5f7f9ad579b9fb0d3700fd31472fb95a"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a5f7f9ad579b9fb0d3700fd31472fb95a">unlock</a> (<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#ae2b0ba067395f1d7588e301f07110b8a">entities_type</a> entities, unsigned long long) noexcept final</td></tr>
<tr class="memdesc:a5f7f9ad579b9fb0d3700fd31472fb95a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock a previously locked sequence of entities.  <br /></td></tr>
<tr class="separator:a5f7f9ad579b9fb0d3700fd31472fb95a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cdf15b69bf6f375ec7083d639f76358" id="r_a4cdf15b69bf6f375ec7083d639f76358"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a4cdf15b69bf6f375ec7083d639f76358">entity_from_buffer</a> (const char *buffer, size_t bytes, bool <a class="el" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a>=true) noexcept</td></tr>
<tr class="memdesc:a4cdf15b69bf6f375ec7083d639f76358"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates an entity id from a sequence of bytes.  <br /></td></tr>
<tr class="separator:a4cdf15b69bf6f375ec7083d639f76358"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb28aedaf5caa53e851165a4f1927207" id="r_afb28aedaf5caa53e851165a4f1927207"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:afb28aedaf5caa53e851165a4f1927207"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#afb28aedaf5caa53e851165a4f1927207">entity_from_string</a> (const std::basic_string&lt; T &gt; &amp;str, bool <a class="el" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a>=true) noexcept</td></tr>
<tr class="memdesc:afb28aedaf5caa53e851165a4f1927207"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates an entity id from a string.  <br /></td></tr>
<tr class="separator:afb28aedaf5caa53e851165a4f1927207"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d62fe0c18bcfb1ade9ff9c7bb00e70b" id="r_a8d62fe0c18bcfb1ade9ff9c7bb00e70b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a8d62fe0c18bcfb1ade9ff9c7bb00e70b">random_entity</a> (bool <a class="el" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a>=true) noexcept</td></tr>
<tr class="memdesc:a8d62fe0c18bcfb1ade9ff9c7bb00e70b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a cryptographically random entity id.  <br /></td></tr>
<tr class="separator:a8d62fe0c18bcfb1ade9ff9c7bb00e70b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab33ccb32052633a55cb3bb5d1bbdf52b" id="r_ab33ccb32052633a55cb3bb5d1bbdf52b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#ab33ccb32052633a55cb3bb5d1bbdf52b">fill_random_entities</a> (span&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a> &gt; seq, bool <a class="el" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a>=true) noexcept</td></tr>
<tr class="memdesc:ab33ccb32052633a55cb3bb5d1bbdf52b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fills a sequence of entity ids with cryptographic randomness. Much faster than calling random_entity() individually.  <br /></td></tr>
<tr class="separator:ab33ccb32052633a55cb3bb5d1bbdf52b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ad0c61b69f363813661dc1971a60dd2" id="r_a8ad0c61b69f363813661dc1971a60dd2"><td class="memItemLeft" align="right" valign="top">result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a8ad0c61b69f363813661dc1971a60dd2">lock</a> (<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#ae2b0ba067395f1d7588e301f07110b8a">entities_type</a> entities, <a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a> d=<a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a>(), bool spin_not_sleep=false) noexcept</td></tr>
<tr class="memdesc:a8ad0c61b69f363813661dc1971a60dd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock all of a sequence of entities for exclusive or shared access.  <br /></td></tr>
<tr class="separator:a8ad0c61b69f363813661dc1971a60dd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0c3cedcbcee27bcba4d161194b45354" id="r_ac0c3cedcbcee27bcba4d161194b45354"><td class="memItemLeft" align="right" valign="top">result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#ac0c3cedcbcee27bcba4d161194b45354">lock</a> (<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a> entity, <a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a> d=<a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a>(), bool spin_not_sleep=false) noexcept</td></tr>
<tr class="memdesc:ac0c3cedcbcee27bcba4d161194b45354"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock a single entity for exclusive or shared access.  <br /></td></tr>
<tr class="separator:ac0c3cedcbcee27bcba4d161194b45354"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdcd49112d1349c42b6e09aeb7ac2212" id="r_afdcd49112d1349c42b6e09aeb7ac2212"><td class="memItemLeft" align="right" valign="top">result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#afdcd49112d1349c42b6e09aeb7ac2212">try_lock</a> (<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#ae2b0ba067395f1d7588e301f07110b8a">entities_type</a> entities) noexcept</td></tr>
<tr class="memdesc:afdcd49112d1349c42b6e09aeb7ac2212"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to lock all of a sequence of entities for exclusive or shared access.  <br /></td></tr>
<tr class="separator:afdcd49112d1349c42b6e09aeb7ac2212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac706e034e46da62f3b8cf5de8d5fdd2" id="r_aac706e034e46da62f3b8cf5de8d5fdd2"><td class="memItemLeft" align="right" valign="top">result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#aac706e034e46da62f3b8cf5de8d5fdd2">try_lock</a> (<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a> entity) noexcept</td></tr>
<tr class="memdesc:aac706e034e46da62f3b8cf5de8d5fdd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to lock a single entity for exclusive or shared access.  <br /></td></tr>
<tr class="separator:aac706e034e46da62f3b8cf5de8d5fdd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a686c02440f55d3ed01770b00c50e49fb" id="r_a686c02440f55d3ed01770b00c50e49fb"><td class="memItemLeft" align="right" valign="top">static result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a686c02440f55d3ed01770b00c50e49fb">fs_mutex_map</a> (const <a class="el" href="classllfio__v2__xxx_1_1path__handle.html">path_handle</a> &amp;base, <a class="el" href="classllfio__v2__xxx_1_1path__view.html">path_view</a> lockfile) noexcept</td></tr>
<tr class="separator:a686c02440f55d3ed01770b00c50e49fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a616679c9b214ef196afddac7315ebf0b" id="r_a616679c9b214ef196afddac7315ebf0b"><td class="memItemLeft" align="right" valign="top">virtual result&lt; void &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a616679c9b214ef196afddac7315ebf0b">_lock</a> (<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &amp;out, <a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a> d, bool spin_not_sleep) noexcept final</td></tr>
<tr class="separator:a616679c9b214ef196afddac7315ebf0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-static-methods" name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:aa33c9b285e1ae967e34eef2417e95627" id="r_aa33c9b285e1ae967e34eef2417e95627"><td class="memItemLeft" align="right" valign="top">static span&lt; <a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map_1_1__entity__idx.html">_entity_idx</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#aa33c9b285e1ae967e34eef2417e95627">_hash_entities</a> (<a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map_1_1__entity__idx.html">_entity_idx</a> *entity_to_idx, <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#ae2b0ba067395f1d7588e301f07110b8a">entities_type</a> &amp;entities)</td></tr>
<tr class="separator:aa33c9b285e1ae967e34eef2417e95627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt;<br />
class llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map&lt; Hasher, HashIndexSize, SpinlockType &gt;</div><p>Many entity memory mapped shared/exclusive file system based lock. </p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">Hasher</td><td>A STL compatible hash algorithm to use (defaults to <code>fnv1a_hash</code>) </td></tr>
    <tr><td class="paramname">HashIndexSize</td><td>The size in bytes of the hash index to use (defaults to 4Kb) </td></tr>
    <tr><td class="paramname">SpinlockType</td><td>The type of spinlock to use (defaults to a <code>SharedMutex</code> concept spinlock)</td></tr>
  </table>
  </dd>
</dl>
<p>This is the highest performing filing system mutex in LLFIO, but it comes with a long list of potential gotchas. It works by creating a random temporary file somewhere on the system and placing its path in a file at the lock file location. The random temporary file is mapped into memory by all processes using the lock where an open addressed hash table is kept. Each entity is hashed into somewhere in the hash table and its individual spin lock is used to implement the exclusion. As with <code>byte_ranges</code>, each entity is locked individually in sequence but if a particular lock fails, all are unlocked and the list is randomised before trying again. Because this locking implementation is entirely implemented in userspace using shared memory without any kernel syscalls, performance is probably as fast as any many-arbitrary-entity shared locking system could be.</p>
<p>As it uses shared memory, this implementation of <code>shared_fs_mutex</code> cannot work over a networked drive. If you attempt to open this lock on a network drive and the first user of the lock is not on this local machine, <code>errc::no_lock_available</code> will be returned from the constructor.</p>
<ul>
<li>Linear complexity to number of concurrent users up until hash table starts to get full or hashed entries collide.</li>
<li>Sudden power loss during use is recovered from.</li>
<li>Safe for multithreaded usage of the same instance.</li>
<li>In the lightly contended case, an order of magnitude faster than any other <code>shared_fs_mutex</code> algorithm.</li>
</ul>
<p>Caveats:</p><ul>
<li>No ability to sleep until a lock becomes free, so CPUs are spun at 100%.</li>
<li>Sudden process exit with locks held will deadlock all other users.</li>
<li>Exponential complexity to number of entities being concurrently locked.</li>
<li>Exponential complexity to concurrency if entities hash to the same cache line. Most SMP and especially NUMA systems have a finite bandwidth for atomic compare and swap operations, and every attempt to lock or unlock an entity under this implementation is several of those operations. Under heavy contention, whole system performance very noticeably nose dives from excessive atomic operations, things like audio and the mouse pointer will stutter.</li>
<li>Sometimes different entities hash to the same offset and collide with one another, causing very poor performance.</li>
<li>Memory mapped files need to be cache unified with normal i/o in your OS kernel. Known OSs which don't use a unified cache for memory mapped and normal i/o are QNX, OpenBSD. Furthermore, doing normal i/o and memory mapped i/o to the same file needs to not corrupt the file. In the past, there have been editions of the Linux kernel and the OS X kernel which did this.</li>
<li>If your OS doesn't have sane byte range locks (OS X, BSD, older Linuxes) and multiple objects in your process use the same lock file, misoperation will occur.</li>
<li><p class="startli">Requires <code>handle::current_path()</code> to be working.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd>memory_map::_hash_entities needs to hash x16, x8 and x4 at a time to encourage auto vectorisation </dd></dl>
</li>
</ul>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a70d275a5256eec64030bfffa87acdb87" name="a70d275a5256eec64030bfffa87acdb87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70d275a5256eec64030bfffa87acdb87">&#9670;&#160;</a></span>memory_map()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType  = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt;::memory_map </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt; &amp;&amp;&#160;</td>
          <td class="paramname"><em>o</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Move constructor. </p>
<div class="fragment"><div class="line"><span class="lineno">  132</span>: _h(std::move(o._h)), _temph(std::move(o._temph)), _hlockinuse(std::move(o._hlockinuse)), _hmap(std::move(o._hmap)), _temphmap(std::move(o._temphmap)) { _hlockinuse.<a class="code hl_function" href="classllfio__v2__xxx_1_1lockable__byte__io__handle_1_1extent__guard.html#a74bfcb2e93ad25ab2084c9305c7f29ca">set_handle</a>(&amp;_h); }</div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1lockable__byte__io__handle_1_1extent__guard_html_a74bfcb2e93ad25ab2084c9305c7f29ca"><div class="ttname"><a href="classllfio__v2__xxx_1_1lockable__byte__io__handle_1_1extent__guard.html#a74bfcb2e93ad25ab2084c9305c7f29ca">llfio_v2_xxx::lockable_byte_io_handle::extent_guard::set_handle</a></div><div class="ttdeci">void set_handle(lockable_byte_io_handle *h) noexcept</div><div class="ttdoc">Sets the lockable_byte_io_handle to be unlocked.</div><div class="ttdef"><b>Definition</b> lockable_byte_io_handle.hpp:207</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac35ad855926d90e7eb0aeaa5e8ddff45" name="ac35ad855926d90e7eb0aeaa5e8ddff45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac35ad855926d90e7eb0aeaa5e8ddff45">&#9670;&#160;</a></span>~memory_map()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType  = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt;::~<a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  141</span>      {</div>
<div class="line"><span class="lineno">  142</span>        <span class="keywordflow">if</span>(_h.<a class="code hl_function" href="classllfio__v2__xxx_1_1handle.html#a5c7f6a0a8ffdea22763c75a9319ba0c2">is_valid</a>())</div>
<div class="line"><span class="lineno">  143</span>        {</div>
<div class="line"><span class="lineno">  144</span>          <span class="comment">// Release the maps</span></div>
<div class="line"><span class="lineno">  145</span>          _hmap = {};</div>
<div class="line"><span class="lineno">  146</span>          _temphmap = {};</div>
<div class="line"><span class="lineno">  147</span>          <span class="comment">// Release my shared locks and try locking inuse exclusively</span></div>
<div class="line"><span class="lineno">  148</span>          _hlockinuse.<a class="code hl_function" href="classllfio__v2__xxx_1_1lockable__byte__io__handle_1_1extent__guard.html#abceed67aad50f870fb23dfcdcd0b9791">unlock</a>();</div>
<div class="line"><span class="lineno">  149</span>          <span class="keyword">auto</span> lockresult = _h.<a class="code hl_function" href="classllfio__v2__xxx_1_1lockable__byte__io__handle.html#a54ca4a58d0bb94d91edc703ffdef3c28">lock_file_range</a>(_initialisingoffset, 2, <a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">lock_kind::exclusive</a>, std::chrono::seconds(0));</div>
<div class="line"><span class="lineno">  150</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  151</span>          <span class="keywordflow">if</span>(!lockresult &amp;&amp; lockresult.error() != errc::timed_out)</div>
<div class="line"><span class="lineno">  152</span>          {</div>
<div class="line"><span class="lineno">  153</span>            LLFIO_LOG_FATAL(0, <span class="stringliteral">&quot;memory_map::~memory_map() try_lock failed&quot;</span>);</div>
<div class="line"><span class="lineno">  154</span>            abort();</div>
<div class="line"><span class="lineno">  155</span>          }</div>
<div class="line"><span class="lineno">  156</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  157</span>          <span class="keywordflow">if</span>(lockresult)</div>
<div class="line"><span class="lineno">  158</span>          {</div>
<div class="line"><span class="lineno">  159</span>            <span class="comment">// This means I am the last user, so zop the file contents as temp file is about to go away</span></div>
<div class="line"><span class="lineno">  160</span>            <span class="keyword">auto</span> o2 = _h.<a class="code hl_function" href="classllfio__v2__xxx_1_1file__handle.html#a730d89cf49839172bf15551139045112">truncate</a>(0);</div>
<div class="line"><span class="lineno">  161</span>            <span class="keywordflow">if</span>(!o2)</div>
<div class="line"><span class="lineno">  162</span>            {</div>
<div class="line"><span class="lineno">  163</span>              LLFIO_LOG_FATAL(0, <span class="stringliteral">&quot;memory_map::~memory_map() truncate failed&quot;</span>);</div>
<div class="line"><span class="lineno">  164</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  165</span>              std::cerr &lt;&lt; <span class="stringliteral">&quot;~memory_map() truncate failed due to &quot;</span> &lt;&lt; o2.error().message().c_str() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  166</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  167</span>              abort();</div>
<div class="line"><span class="lineno">  168</span>            }</div>
<div class="line"><span class="lineno">  169</span>            <span class="comment">// Unlink the temp file. We don&#39;t trap any failure to unlink on FreeBSD it can forget current path.</span></div>
<div class="line"><span class="lineno">  170</span>            <span class="keyword">auto</span> o3 = _temph.<a class="code hl_function" href="classllfio__v2__xxx_1_1fs__handle.html#a7b4f17a0b437d430a37d3875d8570bf2">unlink</a>();</div>
<div class="line"><span class="lineno">  171</span>            <span class="keywordflow">if</span>(!o3)</div>
<div class="line"><span class="lineno">  172</span>            {</div>
<div class="line"><span class="lineno">  173</span><span class="preprocessor">#ifdef __FreeBSD__</span></div>
<div class="line"><span class="lineno">  174</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  175</span>              std::cerr &lt;&lt; <span class="stringliteral">&quot;~memory_map() unlink failed due to &quot;</span> &lt;&lt; o3.error().message().c_str() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  176</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  177</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  178</span>              LLFIO_LOG_FATAL(0, <span class="stringliteral">&quot;memory_map::~memory_map() unlink failed&quot;</span>);</div>
<div class="line"><span class="lineno">  179</span><span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><span class="lineno">  180</span>              std::cerr &lt;&lt; <span class="stringliteral">&quot;~memory_map() unlink failed due to &quot;</span> &lt;&lt; o3.error().message().c_str() &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">  181</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  182</span>              abort();</div>
<div class="line"><span class="lineno">  183</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  184</span>            }</div>
<div class="line"><span class="lineno">  185</span>          }</div>
<div class="line"><span class="lineno">  186</span>        }</div>
<div class="line"><span class="lineno">  187</span>      }</div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1file__handle_html_a730d89cf49839172bf15551139045112"><div class="ttname"><a href="classllfio__v2__xxx_1_1file__handle.html#a730d89cf49839172bf15551139045112">llfio_v2_xxx::file_handle::truncate</a></div><div class="ttdeci">virtual result&lt; extent_type &gt; truncate(extent_type newsize) noexcept</div></div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1fs__handle_html_a7b4f17a0b437d430a37d3875d8570bf2"><div class="ttname"><a href="classllfio__v2__xxx_1_1fs__handle.html#a7b4f17a0b437d430a37d3875d8570bf2">llfio_v2_xxx::fs_handle::unlink</a></div><div class="ttdeci">virtual result&lt; void &gt; unlink(deadline d=std::chrono::seconds(30)) noexcept</div><div class="ttdoc">Unlinks the current path of this open handle, causing its entry to immediately disappear from the fil...</div></div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1handle_html_a5c7f6a0a8ffdea22763c75a9319ba0c2"><div class="ttname"><a href="classllfio__v2__xxx_1_1handle.html#a5c7f6a0a8ffdea22763c75a9319ba0c2">llfio_v2_xxx::handle::is_valid</a></div><div class="ttdeci">bool is_valid() const noexcept</div><div class="ttdoc">True if the handle is valid (and usually open)</div><div class="ttdef"><b>Definition</b> handle.hpp:323</div></div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1lockable__byte__io__handle_1_1extent__guard_html_abceed67aad50f870fb23dfcdcd0b9791"><div class="ttname"><a href="classllfio__v2__xxx_1_1lockable__byte__io__handle_1_1extent__guard.html#abceed67aad50f870fb23dfcdcd0b9791">llfio_v2_xxx::lockable_byte_io_handle::extent_guard::unlock</a></div><div class="ttdeci">void unlock() noexcept</div><div class="ttdoc">Unlocks the locked extent immediately.</div><div class="ttdef"><b>Definition</b> lockable_byte_io_handle.hpp:212</div></div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1lockable__byte__io__handle_html_a54ca4a58d0bb94d91edc703ffdef3c28"><div class="ttname"><a href="classllfio__v2__xxx_1_1lockable__byte__io__handle.html#a54ca4a58d0bb94d91edc703ffdef3c28">llfio_v2_xxx::lockable_byte_io_handle::lock_file_range</a></div><div class="ttdeci">virtual result&lt; extent_guard &gt; lock_file_range(extent_type offset, extent_type bytes, lock_kind kind, deadline d=deadline()) noexcept</div><div class="ttdoc">EXTENSION: Tries to lock the range of bytes specified for shared or exclusive access....</div></div>
<div class="ttc" id="anamespacellfio__v2__xxx_html_ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7"><div class="ttname"><a href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">llfio_v2_xxx::lock_kind::exclusive</a></div><div class="ttdeci">@ exclusive</div><div class="ttdoc">Exclude those requesting any kind of lock on the same inode.</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa33c9b285e1ae967e34eef2417e95627" name="aa33c9b285e1ae967e34eef2417e95627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa33c9b285e1ae967e34eef2417e95627">&#9670;&#160;</a></span>_hash_entities()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType  = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static span&lt; <a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map_1_1__entity__idx.html">_entity_idx</a> &gt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt;::_hash_entities </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map_1_1__entity__idx.html">_entity_idx</a> *&#160;</td>
          <td class="paramname"><em>entity_to_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#ae2b0ba067395f1d7588e301f07110b8a">entities_type</a> &amp;&#160;</td>
          <td class="paramname"><em>entities</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  283</span>      {</div>
<div class="line"><span class="lineno">  284</span>        _entity_idx *ep = entity_to_idx;</div>
<div class="line"><span class="lineno">  285</span>        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> n = 0; n &lt; entities.size(); n++)</div>
<div class="line"><span class="lineno">  286</span>        {</div>
<div class="line"><span class="lineno">  287</span>          ep-&gt;value = <a class="code hl_typedef" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#aa93c292c86b6447bafd9849ad03cfe78">hasher_type</a>()(entities[n].value) % _container_entries;</div>
<div class="line"><span class="lineno">  288</span>          ep-&gt;exclusive = entities[n].exclusive;</div>
<div class="line"><span class="lineno">  289</span>          <span class="keywordtype">bool</span> skip = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  290</span>          <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> m = 0; m &lt; n; m++)</div>
<div class="line"><span class="lineno">  291</span>          {</div>
<div class="line"><span class="lineno">  292</span>            <span class="keywordflow">if</span>(entity_to_idx[m].value == ep-&gt;value)</div>
<div class="line"><span class="lineno">  293</span>            {</div>
<div class="line"><span class="lineno">  294</span>              <span class="keywordflow">if</span>(ep-&gt;exclusive &amp;&amp; !entity_to_idx[m].exclusive)</div>
<div class="line"><span class="lineno">  295</span>              {</div>
<div class="line"><span class="lineno">  296</span>                entity_to_idx[m].exclusive = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  297</span>              }</div>
<div class="line"><span class="lineno">  298</span>              skip = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  299</span>            }</div>
<div class="line"><span class="lineno">  300</span>          }</div>
<div class="line"><span class="lineno">  301</span>          <span class="keywordflow">if</span>(!skip)</div>
<div class="line"><span class="lineno">  302</span>          {</div>
<div class="line"><span class="lineno">  303</span>            ++ep;</div>
<div class="line"><span class="lineno">  304</span>          }</div>
<div class="line"><span class="lineno">  305</span>        }</div>
<div class="line"><span class="lineno">  306</span>        <span class="keywordflow">return</span> span&lt;_entity_idx&gt;(entity_to_idx, ep - entity_to_idx);</div>
<div class="line"><span class="lineno">  307</span>      }</div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map_html_aa93c292c86b6447bafd9849ad03cfe78"><div class="ttname"><a href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#aa93c292c86b6447bafd9849ad03cfe78">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map::hasher_type</a></div><div class="ttdeci">Hasher&lt; entity_type::value_type &gt; hasher_type</div><div class="ttdoc">The type of the hasher being used.</div><div class="ttdef"><b>Definition</b> memory_map.hpp:96</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a616679c9b214ef196afddac7315ebf0b" name="a616679c9b214ef196afddac7315ebf0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a616679c9b214ef196afddac7315ebf0b">&#9670;&#160;</a></span>_lock()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType  = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual result&lt; void &gt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt;::_lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &amp;&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a>&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>spin_not_sleep</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">final</span><span class="mlabel">protected</span><span class="mlabel">virtual</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html">llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  309</span>      {</div>
<div class="line"><span class="lineno">  310</span>        LLFIO_LOG_FUNCTION_CALL(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">  311</span>        std::chrono::steady_clock::time_point began_steady;</div>
<div class="line"><span class="lineno">  312</span>        std::chrono::system_clock::time_point end_utc;</div>
<div class="line"><span class="lineno">  313</span>        <span class="keywordflow">if</span>(d)</div>
<div class="line"><span class="lineno">  314</span>        {</div>
<div class="line"><span class="lineno">  315</span>          <span class="keywordflow">if</span>((d).steady)</div>
<div class="line"><span class="lineno">  316</span>          {</div>
<div class="line"><span class="lineno">  317</span>            began_steady = std::chrono::steady_clock::now();</div>
<div class="line"><span class="lineno">  318</span>          }</div>
<div class="line"><span class="lineno">  319</span>          <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  320</span>          {</div>
<div class="line"><span class="lineno">  321</span>            end_utc = (d).to_time_point();</div>
<div class="line"><span class="lineno">  322</span>          }</div>
<div class="line"><span class="lineno">  323</span>        }</div>
<div class="line"><span class="lineno">  324</span>        <span class="comment">// alloca() always returns 16 byte aligned addresses</span></div>
<div class="line"><span class="lineno">  325</span>        span&lt;_entity_idx&gt; entity_to_idx(_hash_entities(<span class="keyword">reinterpret_cast&lt;</span>_entity_idx *<span class="keyword">&gt;</span>(alloca(<span class="keyword">sizeof</span>(_entity_idx) * out.entities.size())), out.entities));</div>
<div class="line"><span class="lineno">  326</span>        _hash_index_type &amp;index = _index();</div>
<div class="line"><span class="lineno">  327</span>        <span class="comment">// Fire this if an error occurs</span></div>
<div class="line"><span class="lineno">  328</span>        <span class="keyword">auto</span> disableunlock = make_scope_exit([&amp;]() <span class="keyword">noexcept</span> { out.release(); });</div>
<div class="line"><span class="lineno">  329</span>        <span class="keywordtype">size_t</span> n;</div>
<div class="line"><span class="lineno">  330</span>        <span class="keywordflow">for</span>(;;)</div>
<div class="line"><span class="lineno">  331</span>        {</div>
<div class="line"><span class="lineno">  332</span>          <span class="keyword">auto</span> was_contended = <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(-1);</div>
<div class="line"><span class="lineno">  333</span>          {</div>
<div class="line"><span class="lineno">  334</span>            <span class="keyword">auto</span> undo = make_scope_exit([&amp;]() <span class="keyword">noexcept</span> {</div>
<div class="line"><span class="lineno">  335</span>              <span class="comment">// 0 to (n-1) need to be closed</span></div>
<div class="line"><span class="lineno">  336</span>              <span class="keywordflow">if</span>(n &gt; 0)</div>
<div class="line"><span class="lineno">  337</span>              {</div>
<div class="line"><span class="lineno">  338</span>                --n;</div>
<div class="line"><span class="lineno">  339</span>                <span class="comment">// Now 0 to n needs to be closed</span></div>
<div class="line"><span class="lineno">  340</span>                <span class="keywordflow">for</span>(; n &gt; 0; n--)</div>
<div class="line"><span class="lineno">  341</span>                {</div>
<div class="line"><span class="lineno">  342</span>                  entity_to_idx[n].exclusive ? index[entity_to_idx[n].value].unlock() : index[entity_to_idx[n].value].unlock_shared();</div>
<div class="line"><span class="lineno">  343</span>                }</div>
<div class="line"><span class="lineno">  344</span>                entity_to_idx[0].exclusive ? index[entity_to_idx[0].value].unlock() : index[entity_to_idx[0].value].unlock_shared();</div>
<div class="line"><span class="lineno">  345</span>              }</div>
<div class="line"><span class="lineno">  346</span>            });</div>
<div class="line"><span class="lineno">  347</span>            <span class="keywordflow">for</span>(n = 0; n &lt; entity_to_idx.size(); n++)</div>
<div class="line"><span class="lineno">  348</span>            {</div>
<div class="line"><span class="lineno">  349</span>              <span class="keywordflow">if</span>(!(entity_to_idx[n].<a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a> ? index[entity_to_idx[n].value].<a class="code hl_function" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#afdcd49112d1349c42b6e09aeb7ac2212">try_lock</a>() : index[entity_to_idx[n].value].try_lock_shared()))</div>
<div class="line"><span class="lineno">  350</span>              {</div>
<div class="line"><span class="lineno">  351</span>                was_contended = n;</div>
<div class="line"><span class="lineno">  352</span>                <span class="keywordflow">goto</span> failed;</div>
<div class="line"><span class="lineno">  353</span>              }</div>
<div class="line"><span class="lineno">  354</span>            }</div>
<div class="line"><span class="lineno">  355</span>            <span class="comment">// Everything is locked, exit</span></div>
<div class="line"><span class="lineno">  356</span>            undo.release();</div>
<div class="line"><span class="lineno">  357</span>            disableunlock.release();</div>
<div class="line"><span class="lineno">  358</span>            <span class="keywordflow">return</span> success();</div>
<div class="line"><span class="lineno">  359</span>          }</div>
<div class="line"><span class="lineno">  360</span>        failed:</div>
<div class="line"><span class="lineno">  361</span>          <span class="keywordflow">if</span>(d)</div>
<div class="line"><span class="lineno">  362</span>          {</div>
<div class="line"><span class="lineno">  363</span>            <span class="keywordflow">if</span>((d).steady)</div>
<div class="line"><span class="lineno">  364</span>            {</div>
<div class="line"><span class="lineno">  365</span>              <span class="keywordflow">if</span>(std::chrono::steady_clock::now() &gt;= (began_steady + std::chrono::nanoseconds((d).nsecs)))</div>
<div class="line"><span class="lineno">  366</span>              {</div>
<div class="line"><span class="lineno">  367</span>                <span class="keywordflow">return</span> errc::timed_out;</div>
<div class="line"><span class="lineno">  368</span>              }</div>
<div class="line"><span class="lineno">  369</span>            }</div>
<div class="line"><span class="lineno">  370</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  371</span>            {</div>
<div class="line"><span class="lineno">  372</span>              <span class="keywordflow">if</span>(std::chrono::system_clock::now() &gt;= end_utc)</div>
<div class="line"><span class="lineno">  373</span>              {</div>
<div class="line"><span class="lineno">  374</span>                <span class="keywordflow">return</span> errc::timed_out;</div>
<div class="line"><span class="lineno">  375</span>              }</div>
<div class="line"><span class="lineno">  376</span>            }</div>
<div class="line"><span class="lineno">  377</span>          }</div>
<div class="line"><span class="lineno">  378</span>          <span class="comment">// Move was_contended to front and randomise rest of out.entities</span></div>
<div class="line"><span class="lineno">  379</span>          std::swap(entity_to_idx[was_contended], entity_to_idx[0]);</div>
<div class="line"><span class="lineno">  380</span>          <span class="keyword">auto</span> front = entity_to_idx.begin();</div>
<div class="line"><span class="lineno">  381</span>          ++front;</div>
<div class="line"><span class="lineno">  382</span>          QUICKCPPLIB_NAMESPACE::algorithm::small_prng::random_shuffle(front, entity_to_idx.end());</div>
<div class="line"><span class="lineno">  383</span>          <span class="keywordflow">if</span>(!spin_not_sleep)</div>
<div class="line"><span class="lineno">  384</span>          {</div>
<div class="line"><span class="lineno">  385</span>            std::this_thread::yield();</div>
<div class="line"><span class="lineno">  386</span>          }</div>
<div class="line"><span class="lineno">  387</span>        }</div>
<div class="line"><span class="lineno">  388</span>        <span class="comment">// return success();</span></div>
<div class="line"><span class="lineno">  389</span>      }</div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_html_afdcd49112d1349c42b6e09aeb7ac2212"><div class="ttname"><a href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#afdcd49112d1349c42b6e09aeb7ac2212">llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::try_lock</a></div><div class="ttdeci">result&lt; entities_guard &gt; try_lock(entities_type entities) noexcept</div><div class="ttdoc">Try to lock all of a sequence of entities for exclusive or shared access.</div><div class="ttdef"><b>Definition</b> base.hpp:235</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4cdf15b69bf6f375ec7083d639f76358" name="a4cdf15b69bf6f375ec7083d639f76358"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cdf15b69bf6f375ec7083d639f76358">&#9670;&#160;</a></span>entity_from_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a> llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::entity_from_buffer </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>exclusive</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generates an entity id from a sequence of bytes. </p>
<div class="fragment"><div class="line"><span class="lineno">  116</span>      {</div>
<div class="line"><span class="lineno">  117</span>        <a class="code hl_typedef" href="namespacellfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex.html#a4d1eda01c8044f5366e6a49c1839db74">uint128</a> hash = QUICKCPPLIB_NAMESPACE::algorithm::hash::fast_hash::hash(buffer, bytes);</div>
<div class="line"><span class="lineno">  118</span>        <span class="keywordflow">return</span> {hash.as_longlongs[0] ^ hash.as_longlongs[1], <a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a>};</div>
<div class="line"><span class="lineno">  119</span>      }</div>
<div class="ttc" id="anamespacellfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_html_a4d1eda01c8044f5366e6a49c1839db74"><div class="ttname"><a href="namespacellfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex.html#a4d1eda01c8044f5366e6a49c1839db74">llfio_v2_xxx::algorithm::shared_fs_mutex::uint128</a></div><div class="ttdeci">QUICKCPPLIB_NAMESPACE::integers128::uint128 uint128</div><div class="ttdoc">Unsigned 128 bit integer.</div><div class="ttdef"><b>Definition</b> base.hpp:45</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afb28aedaf5caa53e851165a4f1927207" name="afb28aedaf5caa53e851165a4f1927207"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb28aedaf5caa53e851165a4f1927207">&#9670;&#160;</a></span>entity_from_string()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a> llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::entity_from_string </td>
          <td>(</td>
          <td class="paramtype">const std::basic_string&lt; T &gt; &amp;&#160;</td>
          <td class="paramname"><em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>exclusive</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generates an entity id from a string. </p>
<div class="fragment"><div class="line"><span class="lineno">  122</span>      {</div>
<div class="line"><span class="lineno">  123</span>        <a class="code hl_typedef" href="namespacellfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex.html#a4d1eda01c8044f5366e6a49c1839db74">uint128</a> hash = QUICKCPPLIB_NAMESPACE::algorithm::hash::fast_hash::hash(str);</div>
<div class="line"><span class="lineno">  124</span>        <span class="keywordflow">return</span> {hash.as_longlongs[0] ^ hash.as_longlongs[1], <a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a>};</div>
<div class="line"><span class="lineno">  125</span>      }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab33ccb32052633a55cb3bb5d1bbdf52b" name="ab33ccb32052633a55cb3bb5d1bbdf52b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab33ccb32052633a55cb3bb5d1bbdf52b">&#9670;&#160;</a></span>fill_random_entities()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::fill_random_entities </td>
          <td>(</td>
          <td class="paramtype">span&lt; <a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type.html">entity_type</a> &gt;&#160;</td>
          <td class="paramname"><em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>exclusive</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fills a sequence of entity ids with cryptographic randomness. Much faster than calling random_entity() individually. </p>
<div class="fragment"><div class="line"><span class="lineno">  135</span>      {</div>
<div class="line"><span class="lineno">  136</span>        <a class="code hl_function" href="namespacellfio__v2__xxx_1_1utils.html#ae61e2de30b06776a1c24643a1d1dc64e">utils::random_fill</a>(<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(seq.data()), seq.size() * <span class="keyword">sizeof</span>(entity_type));</div>
<div class="line"><span class="lineno">  137</span>        <span class="keywordflow">for</span>(<span class="keyword">auto</span> &amp;i : seq)</div>
<div class="line"><span class="lineno">  138</span>        {</div>
<div class="line"><span class="lineno">  139</span>          i.exclusive = <a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a>;  <span class="comment">// NOLINT</span></div>
<div class="line"><span class="lineno">  140</span>        }</div>
<div class="line"><span class="lineno">  141</span>      }</div>
<div class="ttc" id="anamespacellfio__v2__xxx_1_1utils_html_ae61e2de30b06776a1c24643a1d1dc64e"><div class="ttname"><a href="namespacellfio__v2__xxx_1_1utils.html#ae61e2de30b06776a1c24643a1d1dc64e">llfio_v2_xxx::utils::random_fill</a></div><div class="ttdeci">void random_fill(char *buffer, size_t bytes) noexcept</div><div class="ttdoc">Fills the buffer supplied with cryptographically strong randomness. Uses the OS kernel API.</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a686c02440f55d3ed01770b00c50e49fb" name="a686c02440f55d3ed01770b00c50e49fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a686c02440f55d3ed01770b00c50e49fb">&#9670;&#160;</a></span>fs_mutex_map()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType  = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &gt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt;::fs_mutex_map </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classllfio__v2__xxx_1_1path__handle.html">path_handle</a> &amp;&#160;</td>
          <td class="paramname"><em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllfio__v2__xxx_1_1path__view.html">path_view</a>&#160;</td>
          <td class="paramname"><em>lockfile</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Initialises a shared filing system mutex using the file at <em>lockfile</em>. </p><dl class="section user"><dt>Errors returnable\n Awaiting the clang result&lt;&gt; AST parser which auto generates all the error codes which could occur,</dt><dd>but a particularly important one is <code>errc::no_lock_available</code> which will be returned if the lock is in use by another computer on a network. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  196</span>      {</div>
<div class="line"><span class="lineno">  197</span>        LLFIO_LOG_FUNCTION_CALL(0);</div>
<div class="line"><span class="lineno">  198</span>        LLFIO_EXCEPTION_TRY</div>
<div class="line"><span class="lineno">  199</span>        {</div>
<div class="line"><span class="lineno">  200</span>          OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;ret, <a class="code hl_function" href="classllfio__v2__xxx_1_1file__handle.html#a550d9252db3c099fb149b3e6f5b702b0">file_handle::file</a>(base, lockfile, file_handle::mode::write, file_handle::creation::if_needed, file_handle::caching::reads));</div>
<div class="line"><span class="lineno">  201</span>          file_handle temph;</div>
<div class="line"><span class="lineno">  202</span>          <span class="comment">// Am I the first person to this file? Lock everything exclusively</span></div>
<div class="line"><span class="lineno">  203</span>          <span class="keyword">auto</span> lockinuse = ret.lock_file_range(_initialisingoffset, 2, <a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">lock_kind::exclusive</a>, std::chrono::seconds(0));</div>
<div class="line"><span class="lineno">  204</span>          <span class="keywordflow">if</span>(lockinuse.has_error())</div>
<div class="line"><span class="lineno">  205</span>          {</div>
<div class="line"><span class="lineno">  206</span>            <span class="keywordflow">if</span>(lockinuse.error() != errc::timed_out)</div>
<div class="line"><span class="lineno">  207</span>            {</div>
<div class="line"><span class="lineno">  208</span>              <span class="keywordflow">return</span> std::move(lockinuse).error();</div>
<div class="line"><span class="lineno">  209</span>            }</div>
<div class="line"><span class="lineno">  210</span>            <span class="comment">// Somebody else is also using this file, so try to read the hash index file I ought to use</span></div>
<div class="line"><span class="lineno">  211</span>            lockinuse = ret.lock_file_range(_lockinuseoffset, 1, <a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33a9e81e7b963c71363e2fb3eefcfecfc0e">lock_kind::shared</a>);  <span class="comment">// inuse shared access, blocking</span></div>
<div class="line"><span class="lineno">  212</span>            <span class="keywordflow">if</span>(!lockinuse)</div>
<div class="line"><span class="lineno">  213</span>            {</div>
<div class="line"><span class="lineno">  214</span>              <span class="keywordflow">return</span> std::move(lockinuse).error();</div>
<div class="line"><span class="lineno">  215</span>            }</div>
<div class="line"><span class="lineno">  216</span>            <span class="keywordtype">byte</span> buffer[65536];</div>
<div class="line"><span class="lineno">  217</span>            memset(buffer, 0, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line"><span class="lineno">  218</span>            OUTCOME_TRYV(ret.read(0, {{buffer, 65535}}));</div>
<div class="line"><span class="lineno">  219</span>            path_view temphpath(<span class="keyword">reinterpret_cast&lt;</span>filesystem::path::value_type *<span class="keyword">&gt;</span>(buffer));</div>
<div class="line"><span class="lineno">  220</span>            result&lt;file_handle&gt; _temph(in_place_type&lt;file_handle&gt;);</div>
<div class="line"><span class="lineno">  221</span>            _temph = <a class="code hl_function" href="classllfio__v2__xxx_1_1file__handle.html#a550d9252db3c099fb149b3e6f5b702b0">file_handle::file</a>({}, temphpath, file_handle::mode::write, file_handle::creation::open_existing, file_handle::caching::temporary);</div>
<div class="line"><span class="lineno">  222</span>            <span class="comment">// If temp file doesn&#39;t exist, I am on a different machine</span></div>
<div class="line"><span class="lineno">  223</span>            <span class="keywordflow">if</span>(!_temph)</div>
<div class="line"><span class="lineno">  224</span>            {</div>
<div class="line"><span class="lineno">  225</span>              <span class="comment">// Release the exclusive lock and tell caller that this lock is not available</span></div>
<div class="line"><span class="lineno">  226</span>              <span class="keywordflow">return</span> errc::no_lock_available;</div>
<div class="line"><span class="lineno">  227</span>            }</div>
<div class="line"><span class="lineno">  228</span>            temph = std::move(_temph.value());</div>
<div class="line"><span class="lineno">  229</span>            <span class="comment">// Map the hash index file into memory for read/write access</span></div>
<div class="line"><span class="lineno">  230</span>            OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;temphsection, <a class="code hl_function" href="classllfio__v2__xxx_1_1section__handle.html#a07dc4eba215e0b670f807faa0f9b52b1">section_handle::section</a>(temph, HashIndexSize));</div>
<div class="line"><span class="lineno">  231</span>            OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;temphmap, <a class="code hl_function" href="classllfio__v2__xxx_1_1map__handle.html#afbfef7261a6b11d9c23ad97b6ce0f6fb">map_handle::map</a>(temphsection, HashIndexSize));</div>
<div class="line"><span class="lineno">  232</span>            <span class="comment">// Map the path file into memory with its maximum possible size, read only</span></div>
<div class="line"><span class="lineno">  233</span>            OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;hsection, <a class="code hl_function" href="classllfio__v2__xxx_1_1section__handle.html#a07dc4eba215e0b670f807faa0f9b52b1">section_handle::section</a>(ret, 65536, section_handle::flag::read));</div>
<div class="line"><span class="lineno">  234</span>            OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;hmap, <a class="code hl_function" href="classllfio__v2__xxx_1_1map__handle.html#afbfef7261a6b11d9c23ad97b6ce0f6fb">map_handle::map</a>(hsection, 0, 0, section_handle::flag::read));</div>
<div class="line"><span class="lineno">  235</span>            <span class="keywordflow">return</span> memory_map(std::move(ret), std::move(temph), std::move(lockinuse.value()), std::move(hmap), std::move(temphmap));</div>
<div class="line"><span class="lineno">  236</span>          }</div>
<div class="line"><span class="lineno">  237</span> </div>
<div class="line"><span class="lineno">  238</span>          <span class="comment">// I am the first person to be using this (stale?) file, so create a new hash index file in /tmp</span></div>
<div class="line"><span class="lineno">  239</span>          <span class="keyword">auto</span> &amp;tempdirh = <a class="code hl_function" href="namespacellfio__v2__xxx_1_1path__discovery.html#aa99c9c7335db78b5135c85c58aeaa3fe">path_discovery::memory_backed_temporary_files_directory</a>().<a class="code hl_function" href="classllfio__v2__xxx_1_1handle.html#a5c7f6a0a8ffdea22763c75a9319ba0c2">is_valid</a>() ? <a class="code hl_function" href="namespacellfio__v2__xxx_1_1path__discovery.html#aa99c9c7335db78b5135c85c58aeaa3fe">path_discovery::memory_backed_temporary_files_directory</a>() : path_discovery::<a class="code hl_function" href="namespacellfio__v2__xxx_1_1path__discovery.html#a7b400319c8c5973bb2ccbf6f1c38b4db">storage_backed_temporary_files_directory</a>();</div>
<div class="line"><span class="lineno">  240</span>          OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;_temph, <a class="code hl_function" href="classllfio__v2__xxx_1_1file__handle.html#a2cc96276fb1e7788bd4a222e91d9bfed">file_handle::uniquely_named_file</a>(tempdirh));</div>
<div class="line"><span class="lineno">  241</span>          temph = std::move(_temph);</div>
<div class="line"><span class="lineno">  242</span>          <span class="comment">// Truncate it out to the hash index size, and map it into memory for read/write access</span></div>
<div class="line"><span class="lineno">  243</span>          OUTCOME_TRYV(temph.truncate(HashIndexSize));</div>
<div class="line"><span class="lineno">  244</span>          OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;temphsection, <a class="code hl_function" href="classllfio__v2__xxx_1_1section__handle.html#a07dc4eba215e0b670f807faa0f9b52b1">section_handle::section</a>(temph, HashIndexSize));</div>
<div class="line"><span class="lineno">  245</span>          OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;temphmap, <a class="code hl_function" href="classllfio__v2__xxx_1_1map__handle.html#afbfef7261a6b11d9c23ad97b6ce0f6fb">map_handle::map</a>(temphsection, HashIndexSize));</div>
<div class="line"><span class="lineno">  246</span>          <span class="comment">// Write the path of my new hash index file, padding zeros to the nearest page size</span></div>
<div class="line"><span class="lineno">  247</span>          <span class="comment">// multiple to work around a race condition in the Linux kernel</span></div>
<div class="line"><span class="lineno">  248</span>          OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;temppath, temph.current_path());</div>
<div class="line"><span class="lineno">  249</span>          <span class="keywordtype">char</span> buffer[4096];</div>
<div class="line"><span class="lineno">  250</span>          memset(buffer, 0, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line"><span class="lineno">  251</span>          <span class="keywordtype">size_t</span> bytes = temppath.native().size() * <span class="keyword">sizeof</span>(*temppath.c_str());</div>
<div class="line"><span class="lineno">  252</span>          file_handle::const_buffer_type buffers[] = {{<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">byte</span> *<span class="keyword">&gt;</span>(temppath.c_str()), bytes}, {<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">byte</span> *<span class="keyword">&gt;</span>(buffer), 4096 - (bytes % 4096)}};</div>
<div class="line"><span class="lineno">  253</span>          OUTCOME_TRYV(ret.truncate(65536));</div>
<div class="line"><span class="lineno">  254</span>          OUTCOME_TRYV(ret.write({buffers, 0}));</div>
<div class="line"><span class="lineno">  255</span>          <span class="comment">// Map for read the maximum possible path file size, again to avoid race problems</span></div>
<div class="line"><span class="lineno">  256</span>          OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;hsection, <a class="code hl_function" href="classllfio__v2__xxx_1_1section__handle.html#a07dc4eba215e0b670f807faa0f9b52b1">section_handle::section</a>(ret, 65536, section_handle::flag::read));</div>
<div class="line"><span class="lineno">  257</span>          OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;hmap, <a class="code hl_function" href="classllfio__v2__xxx_1_1map__handle.html#afbfef7261a6b11d9c23ad97b6ce0f6fb">map_handle::map</a>(hsection, 0, 0, section_handle::flag::read));</div>
<div class="line"><span class="lineno">  258</span>          <span class="comment">/* Take shared locks on inuse. Even if this implementation doesn&#39;t implement</span></div>
<div class="line"><span class="lineno">  259</span><span class="comment">          atomic downgrade of exclusive range to shared range, we&#39;re fully prepared for other users</span></div>
<div class="line"><span class="lineno">  260</span><span class="comment">          now. The _initialisingoffset remains exclusive to prevent double entry into this init routine.</span></div>
<div class="line"><span class="lineno">  261</span><span class="comment">          */</span></div>
<div class="line"><span class="lineno">  262</span>          OUTCOME_TRY(<span class="keyword">auto</span> &amp;&amp;lockinuse2, ret.lock_file_range(_lockinuseoffset, 1, <a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33a9e81e7b963c71363e2fb3eefcfecfc0e">lock_kind::shared</a>));</div>
<div class="line"><span class="lineno">  263</span>          lockinuse = std::move(lockinuse2);  <span class="comment">// releases exclusive lock on all three offsets</span></div>
<div class="line"><span class="lineno">  264</span>          <span class="keywordflow">return</span> memory_map(std::move(ret), std::move(temph), std::move(lockinuse.value()), std::move(hmap), std::move(temphmap));</div>
<div class="line"><span class="lineno">  265</span>        }</div>
<div class="line"><span class="lineno">  266</span>        LLFIO_EXCEPTION_CATCH_ALL</div>
<div class="line"><span class="lineno">  267</span>        {</div>
<div class="line"><span class="lineno">  268</span>          <span class="keywordflow">return</span> error_from_exception();</div>
<div class="line"><span class="lineno">  269</span>        }</div>
<div class="line"><span class="lineno">  270</span>      }</div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1file__handle_html_a2cc96276fb1e7788bd4a222e91d9bfed"><div class="ttname"><a href="classllfio__v2__xxx_1_1file__handle.html#a2cc96276fb1e7788bd4a222e91d9bfed">llfio_v2_xxx::file_handle::uniquely_named_file</a></div><div class="ttdeci">static result&lt; file_handle &gt; uniquely_named_file(const path_handle &amp;dirpath, mode _mode=mode::write, caching _caching=caching::temporary, flag flags=flag::none) noexcept</div><div class="ttdef"><b>Definition</b> file_handle.hpp:175</div></div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1file__handle_html_a550d9252db3c099fb149b3e6f5b702b0"><div class="ttname"><a href="classllfio__v2__xxx_1_1file__handle.html#a550d9252db3c099fb149b3e6f5b702b0">llfio_v2_xxx::file_handle::file</a></div><div class="ttdeci">static result&lt; file_handle &gt; file(const path_handle &amp;base, path_view_type path, mode _mode=mode::read, creation _creation=creation::open_existing, caching _caching=caching::all, flag flags=flag::none) noexcept</div></div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1map__handle_html_afbfef7261a6b11d9c23ad97b6ce0f6fb"><div class="ttname"><a href="classllfio__v2__xxx_1_1map__handle.html#afbfef7261a6b11d9c23ad97b6ce0f6fb">llfio_v2_xxx::map_handle::map</a></div><div class="ttdeci">static result&lt; map_handle &gt; map(size_type bytes, bool zeroed=false, section_handle::flag _flag=section_handle::flag::readwrite) noexcept</div><div class="ttdef"><b>Definition</b> map_handle.hpp:633</div></div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1section__handle_html_a07dc4eba215e0b670f807faa0f9b52b1"><div class="ttname"><a href="classllfio__v2__xxx_1_1section__handle.html#a07dc4eba215e0b670f807faa0f9b52b1">llfio_v2_xxx::section_handle::section</a></div><div class="ttdeci">static result&lt; section_handle &gt; section(file_handle &amp;backing, extent_type maximum_size, flag _flag) noexcept</div><div class="ttdoc">Create a memory section backed by a file.</div></div>
<div class="ttc" id="anamespacellfio__v2__xxx_1_1path__discovery_html_a7b400319c8c5973bb2ccbf6f1c38b4db"><div class="ttname"><a href="namespacellfio__v2__xxx_1_1path__discovery.html#a7b400319c8c5973bb2ccbf6f1c38b4db">llfio_v2_xxx::path_discovery::storage_backed_temporary_files_directory</a></div><div class="ttdeci">const path_handle &amp; storage_backed_temporary_files_directory() noexcept</div><div class="ttdoc">Returns a reference to an open handle to a verified temporary directory where files created are store...</div></div>
<div class="ttc" id="anamespacellfio__v2__xxx_1_1path__discovery_html_aa99c9c7335db78b5135c85c58aeaa3fe"><div class="ttname"><a href="namespacellfio__v2__xxx_1_1path__discovery.html#aa99c9c7335db78b5135c85c58aeaa3fe">llfio_v2_xxx::path_discovery::memory_backed_temporary_files_directory</a></div><div class="ttdeci">const path_handle &amp; memory_backed_temporary_files_directory() noexcept</div><div class="ttdoc">Returns a reference to an open handle to a verified temporary directory where files created are store...</div></div>
<div class="ttc" id="anamespacellfio__v2__xxx_html_ae79486289ff1386b26d1ce60bb797d33a9e81e7b963c71363e2fb3eefcfecfc0e"><div class="ttname"><a href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33a9e81e7b963c71363e2fb3eefcfecfc0e">llfio_v2_xxx::lock_kind::shared</a></div><div class="ttdeci">@ shared</div><div class="ttdoc">Exclude only those requesting an exclusive lock on the same inode.</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac239630e7441631344f828be5fd19360" name="ac239630e7441631344f828be5fd19360"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac239630e7441631344f828be5fd19360">&#9670;&#160;</a></span>handle()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType  = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classllfio__v2__xxx_1_1file__handle.html">file_handle</a> &amp; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt;::handle </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the handle to file being used for this lock. </p>
<div class="fragment"><div class="line"><span class="lineno">  273</span>{ <span class="keywordflow">return</span> _h; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ad0c61b69f363813661dc1971a60dd2" name="a8ad0c61b69f363813661dc1971a60dd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ad0c61b69f363813661dc1971a60dd2">&#9670;&#160;</a></span>lock() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt; llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#aec91125605e5a8379b7616b7f90d1232">entities_type</a>&#160;</td>
          <td class="paramname"><em>entities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a>&#160;</td>
          <td class="paramname"><em>d</em> = <code><a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a>()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>spin_not_sleep</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Lock all of a sequence of entities for exclusive or shared access. </p>
<div class="fragment"><div class="line"><span class="lineno">  222</span>      {</div>
<div class="line"><span class="lineno">  223</span>        entities_guard ret(<span class="keyword">this</span>, entities);</div>
<div class="line"><span class="lineno">  224</span>        OUTCOME_TRYV(_lock(ret, d, spin_not_sleep));</div>
<div class="line"><span class="lineno">  225</span>        <span class="keywordflow">return</span> {std::move(ret)};</div>
<div class="line"><span class="lineno">  226</span>      }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0c3cedcbcee27bcba4d161194b45354" name="ac0c3cedcbcee27bcba4d161194b45354"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0c3cedcbcee27bcba4d161194b45354">&#9670;&#160;</a></span>lock() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt; llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type.html">entity_type</a>&#160;</td>
          <td class="paramname"><em>entity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a>&#160;</td>
          <td class="paramname"><em>d</em> = <code><a class="el" href="structllfio__v2__xxx_1_1deadline.html">deadline</a>()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>spin_not_sleep</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Lock a single entity for exclusive or shared access. </p>
<div class="fragment"><div class="line"><span class="lineno">  229</span>      {</div>
<div class="line"><span class="lineno">  230</span>        entities_guard ret(<span class="keyword">this</span>, entity);</div>
<div class="line"><span class="lineno">  231</span>        OUTCOME_TRYV(_lock(ret, d, spin_not_sleep));</div>
<div class="line"><span class="lineno">  232</span>        <span class="keywordflow">return</span> {std::move(ret)};</div>
<div class="line"><span class="lineno">  233</span>      }</div>
</div><!-- fragment -->
</div>
</div>
<a id="adcd21bb3b7c8c93dc9b19e3d3f9e0572" name="adcd21bb3b7c8c93dc9b19e3d3f9e0572"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcd21bb3b7c8c93dc9b19e3d3f9e0572">&#9670;&#160;</a></span>operator=()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType  = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a> &amp; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt;::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt; &amp;&amp;&#160;</td>
          <td class="paramname"><em>o</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Move assign. </p>
<div class="fragment"><div class="line"><span class="lineno">  135</span>      {</div>
<div class="line"><span class="lineno">  136</span>        this-&gt;~memory_map();</div>
<div class="line"><span class="lineno">  137</span>        <span class="keyword">new</span>(<span class="keyword">this</span>) memory_map(std::move(o));</div>
<div class="line"><span class="lineno">  138</span>        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  139</span>      }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8d62fe0c18bcfb1ade9ff9c7bb00e70b" name="a8d62fe0c18bcfb1ade9ff9c7bb00e70b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d62fe0c18bcfb1ade9ff9c7bb00e70b">&#9670;&#160;</a></span>random_entity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#a578299b4449875303911db495a9a81ed">entity_type</a> llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::random_entity </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>exclusive</em> = <code>true</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generates a cryptographically random entity id. </p>
<div class="fragment"><div class="line"><span class="lineno">  128</span>      {</div>
<div class="line"><span class="lineno">  129</span>        <a class="code hl_typedef" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type.html#adfb9e2612d4f570f0d3eb043bbb05d81">entity_type::value_type</a> v;</div>
<div class="line"><span class="lineno">  130</span>        <a class="code hl_function" href="namespacellfio__v2__xxx_1_1utils.html#ae61e2de30b06776a1c24643a1d1dc64e">utils::random_fill</a>(<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(&amp;v), <span class="keyword">sizeof</span>(v));</div>
<div class="line"><span class="lineno">  131</span>        <span class="keywordflow">return</span> {v, <a class="code hl_enumvalue" href="namespacellfio__v2__xxx.html#ae79486289ff1386b26d1ce60bb797d33aa4293995cfbfa9ce60ce71ade2ff75f7">exclusive</a>};</div>
<div class="line"><span class="lineno">  132</span>      }</div>
<div class="ttc" id="astructllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type_html_adfb9e2612d4f570f0d3eb043bbb05d81"><div class="ttname"><a href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type.html#adfb9e2612d4f570f0d3eb043bbb05d81">llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::entity_type::value_type</a></div><div class="ttdeci">handle::extent_type value_type</div><div class="ttdoc">The type backing the value.</div><div class="ttdef"><b>Definition</b> base.hpp:63</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afdcd49112d1349c42b6e09aeb7ac2212" name="afdcd49112d1349c42b6e09aeb7ac2212"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdcd49112d1349c42b6e09aeb7ac2212">&#9670;&#160;</a></span>try_lock() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt; llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::try_lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#aec91125605e5a8379b7616b7f90d1232">entities_type</a>&#160;</td>
          <td class="paramname"><em>entities</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Try to lock all of a sequence of entities for exclusive or shared access. </p>
<div class="fragment"><div class="line"><span class="lineno">  235</span>{ <span class="keywordflow">return</span> <a class="code hl_function" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a8ad0c61b69f363813661dc1971a60dd2">lock</a>(entities, deadline(std::chrono::seconds(0))); }</div>
<div class="ttc" id="aclassllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_html_a8ad0c61b69f363813661dc1971a60dd2"><div class="ttname"><a href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a8ad0c61b69f363813661dc1971a60dd2">llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::lock</a></div><div class="ttdeci">result&lt; entities_guard &gt; lock(entities_type entities, deadline d=deadline(), bool spin_not_sleep=false) noexcept</div><div class="ttdoc">Lock all of a sequence of entities for exclusive or shared access.</div><div class="ttdef"><b>Definition</b> base.hpp:221</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aac706e034e46da62f3b8cf5de8d5fdd2" name="aac706e034e46da62f3b8cf5de8d5fdd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac706e034e46da62f3b8cf5de8d5fdd2">&#9670;&#160;</a></span>try_lock() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">result&lt; <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entities__guard.html">entities_guard</a> &gt; llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex::try_lock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex_1_1entity__type.html">entity_type</a>&#160;</td>
          <td class="paramname"><em>entity</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Try to lock a single entity for exclusive or shared access. </p>
<div class="fragment"><div class="line"><span class="lineno">  237</span>{ <span class="keywordflow">return</span> <a class="code hl_function" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a8ad0c61b69f363813661dc1971a60dd2">lock</a>(entity, deadline(std::chrono::seconds(0))); }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5f7f9ad579b9fb0d3700fd31472fb95a" name="a5f7f9ad579b9fb0d3700fd31472fb95a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f7f9ad579b9fb0d3700fd31472fb95a">&#9670;&#160;</a></span>unlock()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; class &gt; class Hasher = QUICKCPPLIB_NAMESPACE::algorithm::hash::fnv1a_hash, size_t HashIndexSize = 4096, class SpinlockType  = QUICKCPPLIB_NAMESPACE::configurable_spinlock::shared_spinlock&lt;&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">llfio_v2_xxx::algorithm::shared_fs_mutex::memory_map</a>&lt; Hasher, HashIndexSize, SpinlockType &gt;::unlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html#ae2b0ba067395f1d7588e301f07110b8a">entities_type</a>&#160;</td>
          <td class="paramname"><em>entities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long long&#160;</td>
          <td class="paramname"><em>hint</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">final</span><span class="mlabel">virtual</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unlock a previously locked sequence of entities. </p>

<p>Implements <a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1shared__fs__mutex.html#a645f3ecd3a841cb7311102dea4f36757">llfio_v2_xxx::algorithm::shared_fs_mutex::shared_fs_mutex</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  393</span>      {</div>
<div class="line"><span class="lineno">  394</span>        LLFIO_LOG_FUNCTION_CALL(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">  395</span>        span&lt;_entity_idx&gt; entity_to_idx(_hash_entities(<span class="keyword">reinterpret_cast&lt;</span>_entity_idx *<span class="keyword">&gt;</span>(alloca(<span class="keyword">sizeof</span>(_entity_idx) * entities.size())), entities));</div>
<div class="line"><span class="lineno">  396</span>        _hash_index_type &amp;index = _index();</div>
<div class="line"><span class="lineno">  397</span>        <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span> &amp;i : entity_to_idx)</div>
<div class="line"><span class="lineno">  398</span>        {</div>
<div class="line"><span class="lineno">  399</span>          i.exclusive ? index[i.value].unlock() : index[i.value].unlock_shared();</div>
<div class="line"><span class="lineno">  400</span>        }</div>
<div class="line"><span class="lineno">  401</span>      }</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>include/llfio/v2.0/algorithm/shared_fs_mutex/<a class="el" href="memory__map_8hpp.html">memory_map.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacellfio__v2__xxx.html">llfio_v2_xxx</a></li><li class="navelem"><a class="el" href="namespacellfio__v2__xxx_1_1algorithm.html">algorithm</a></li><li class="navelem"><a class="el" href="namespacellfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex.html">shared_fs_mutex</a></li><li class="navelem"><a class="el" href="classllfio__v2__xxx_1_1algorithm_1_1shared__fs__mutex_1_1memory__map.html">memory_map</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
